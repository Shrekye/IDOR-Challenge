{% extends "base.html" %}
{% block content %}
<h2>Page principale</h2>
<p>Bonjour {{ username }} — entre le flag ci-dessous :</p>

<form id="flag-form" method="post" action="{{ url_for('submit_flag') }}">
  <input type="text" name="flag" placeholder="Entrez le flag ici" size="40" required>
  <button type="submit">Soumettre</button>
</form>

<div style="margin-top:16px;">
  <a href="{{ url_for('user_profile', id=session['user_id']) }}">
    <button class="secondary">Mon profil</button>
  </a>
</div>

<script>
document.getElementById("flag-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const form = e.target;
  const data = new FormData(form);

  const response = await fetch(form.action, {
    method: "POST",
    body: data
  });

  const result = await response.json();

  if (result.status === "success") {
    alert(result.message);
  } else if (result.status === "fail") {
    alert("❌ " + result.message);
  } else {
    alert("⚠️ " + result.message);
  }

  form.reset(); 
});
</script>
{% endblock %}
